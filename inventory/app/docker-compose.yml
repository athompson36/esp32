# Run inventory web app + AI tools in Docker.
# From repo root: docker compose -f inventory/app/docker-compose.yml up -d --build
# Then open http://127.0.0.1:5050 (or http://<your-lan-ip>:5050 from other devices).
# restart: unless-stopped â€” container auto-restarts on failure and starts when Docker daemon starts.

services:
  inventory:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      # Bind to all interfaces (0.0.0.0) so the app is reachable from LAN, not only localhost
      - "0.0.0.0:5050:5050"
    environment:
      - REPO_ROOT=/workspace
      - PORT=5050
      - FLASK_DEBUG=0
      # Optional: for AI natural-language answers and update summaries
      # - OPENAI_API_KEY=sk-...
    volumes:
      # Mount whole repo: read inventory.db, YAML; write project proposals to artifacts/project_proposals
      - ../..:/workspace
      # Mount host Docker socket so the app can list/start/stop lab containers (Docker CLI is in the image)
      - /var/run/docker.sock:/var/run/docker.sock
    restart: unless-stopped
